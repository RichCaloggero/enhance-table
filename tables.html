<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, user-scalable=yes">
<title>Tables</title>
</head>
<body>
<h1>Tables</h1>

<table class="sortable">
<thead><tr class="sort">
<th>Name</th>
<th>Coffees per Day</th>
</tr></thead>

<tr><td>Hyper</td><td>13</td></tr>
<tr><td>Rich</td><td>3</td></tr>
<tr><td>Conservative</td><td>1</td></tr>
</table>

<script>
makeSortable (document.querySelector ("table"));


function makeSortable (table) {
let headerRow = table.querySelector ("tr.sort") || table.querySelector ("tr");
if (! headerRow) {
alert ("invalid table, must contain at least 1 'tr' element");
return;
} // if
addSortControls (table, headerRow);

headerRow.addEventListener ("click", (e) => {
let cell = e.target.parentElement;
console.log ("clicked: ", cell);

if (cell.tagName.toLowerCase() === "th") {
let direction = cell.getAttribute ("aria-sort");

if (direction) {
direction = (direction === "ascending")? "descending" : "ascending";
} else {
Array.from(headerRow.querySelectorAll ("[aria-sort]"))
.forEach (cell => cell.setAttribute ("aria-sort", ""));
direction = "ascending";
} // if

cell.setAttribute ("aria-sort", direction);
sortTable (table, columnIndex(cell), direction);
} // if
}); // handler


function addSortControls (table, headerRow) {
Array.from(headerRow.querySelectorAll ("th"))
.map (cell => {
cell.innerHTML = `<button>${cell.textContent}</button>`;
cell.setAttribute ("aria-sort", "");
});
} // addSortControls

function sortTable (table, sortBy, direction) {
console.log (`sortTable ${sortBy}, ${direction}`);
data = extractData (table);

let compare = (direction === "ascending")? compareAscending : compareDescending;
data.sort ((a, b) => compare(a[sortBy], b[sortBy]));
console.log (data.join(", "));

rewriteData (table, data);
return data;
} // sortTable


function extractData (table) {
return Array.from(table.querySelectorAll ("tbody tr"))
.map (tr => Array.from (tr.querySelectorAll ("td, th"))
.map (cell => cell.textContent) // map over cells in row
); // map over rows
} // extractData

function rewriteData (table, data) {
Array.from(table.querySelectorAll ("tbody tr"))
.map ((tr, r) => Array.from (tr.querySelectorAll ("td, th"))
.map ((cell, c) => cell.textContent = data[r][c]) // map over cells in row
); // map over rows
} // rewriteData

function columnIndex (cell) {
return Array.from(cell.parentElement.children).indexOf(cell);
} // columnIndex

function compareAscending (a, b) {
if (a < b) return -1;
else if (a > b) return 1;
else return 0;
} // compareAscending

function compareDescending (a, b) {
if (a < b) return 1;
else if (a > b) return -1;
else return 0;
} // compareDescending

} // makeSortable
</script>

</body>
</html>
